---
title: "Getting started"
format:
  html:
    toc: true
knitr:
  opts_chunk:
    collapse: true
    comment: '#>'
    message: false
---

```{r}
#| label: setup
#| include: false
library(tidyhydro)
library(ggplot2)
theme_set(
  theme_minimal() +
    theme(legend.position = "bottom")
)
```

The package includes the mean daily water discharge values (`obs` in m³/s) measured at the state gauging station [Avacha River — Elizovo City](https://www.openstreetmap.org/#map=18/53.183111/158.393269) (site No. 2090). Alongside the measured water discharge, the mean water discharge in the last 24 hours derived from the [GloFAS-ERA5 v4.0](https://confluence.ecmwf.int/display/CEMS/GloFAS+v4.0) reanalysis is provided (`sim`).

```{r}
#| fig-cap: Avacha River - Elizovo City hydrograph
library(ggplot2)
library(tidyhydro)
data(avacha)

avacha |>
  ggplot(aes(x = date)) +
  geom_line(aes(y = obs, colour = "Measured")) +
  geom_line(aes(y = sim, colour = "Predicted")) +
  scale_colour_brewer(name = "", palette = "Set1") +
  labs(x = "", y = "Water Discharge, m³/s")
```

# Example usage

One can estimate the desired metrics using the `tidyverse` [syntax](https://style.tidyverse.org/). For example, to get the Nash-Sutcliffe Efficiency ($NSE$) or Modified Kling-Gupta Efficiency ($KGE'$) for the `avacha` dataset, one can run:

```{r}
nse(avacha, obs, sim)
kge2012(avacha, obs, sim)
```

Or using the `yardstick` helper functions, one can create a metric set, combining it with other `yardstick` metrics, such as $R^2$:

```{r}
library(yardstick)
hydro_metrics <- metric_set(kge, pbias, rsq)
hydro_metrics(avacha, obs, sim)
```

Such syntax is particularly useful when running a group analysis, for example, estimating model performance for different months:

```{r}
library(lubridate)
library(dplyr)

avacha |>
  mutate(month = month(date)) |>
  group_by(month) |>
  nse(obs, sim)
```

Alternatively, one can still use the vectorised versions of the metrics, ending with the `*_vec` suffix:

```{r}
nse_vec(truth = avacha$obs, estimate = avacha$sim)
```